VERSION := 0.4.0

.PHONY: publish
publish:
	@perl -i \
		-pe 's/version = "\d+\.\d+\.\d+"/version = "${VERSION}"/g' \
		crates/perplexity-web-api-mcp/Cargo.toml
	@cargo update -p perplexity-web-api-mcp
	@git add \
		Makefile \
		Cargo.lock \
		crates/perplexity-web-api-mcp/Cargo.toml
	@git commit -m "chore: release ${VERSION} ðŸ”¥"
	@git tag "v${VERSION}"
	@git-cliff -o CHANGELOG.md
	@git tag -d "v${VERSION}"
	@git add CHANGELOG.md
	@git commit --amend --no-edit
	@git tag -a "v${VERSION}" -m "release v${VERSION}"
	@git push
	@git push --tags
